# Region 1 (worker & log & meta) - Node 1 Configuration

serviceAccount:
  annotations:
    # a role that can access the S3 bucket
    eks.amazonaws.com/role-arn: arn:aws:iam::1234567890:role/my-role

env:
  # --------------------
  # common params
  # --------------------
  - name: RESTATE_LOG_FORMAT
    value: "json"
  - name: RESTATE_CLUSTER_NAME
    value: "multi-region-demo-cluster"
  - name: RESTATE_METADATA_SERVER__TYPE
    value: "replicated"
  - name: RESTATE_DEFAULT_REPLICATION
    value: "2"
  - name: RESTATE_BIFROST__DEFAULT_PROVIDER
    value: "replicated"
  - name: RESTATE_DEFAULT_NUM_PARTITIONS
    value: "128"
  - name: RESTATE_ROCKSDB_TOTAL_MEMORY_SIZE
    value: "1024MB"
  - name: RESTATE_WORKER__SNAPSHOTS__SNAPSHOT_INTERVAL_NUM_RECORDS
    value: "10000"

  # --------------------
  # node specific params
  # --------------------
  - name: RESTATE_NODE_NAME
    value: "node1"
  - name: RESTATE_FORCE_NODE_ID
    value: "1"
  - name: RESTATE_ROLES
    value: '["admin","metadata-server","log-server","worker"]'
  - name: RESTATE_AUTO_PROVISION
    value: "true"

  # --------------------
  # params that need to be overridden
  # --------------------
  # this needs to be an address the other two nodes can resolve and reach
  # the example given here only works if all three are in the same cluster (eg in different namespaces)
  # (and it assumes the namespace deployed into is restate-node1)
  # across regions, you probably need an NLB and a DNS name that is globally reachable
  - name: RESTATE_ADVERTISED_ADDRESS
    value: "http://restate-0.restate-cluster.restate-node1:5122"
  # this should be the values of RESTATE_ADVERTISED_ADDRESS for each of the 3 nodes
  - name: RESTATE_METADATA_CLIENT__ADDRESSES
    value: '["http://restate-0.restate-cluster.restate-node1:5122","http://restate-0.restate-cluster.restate-node2:5122","http://restate-0.restate-cluster.restate-node3:5122"]'
  # this should be the region of the below bucket
  - name: RESTATE_WORKER__SNAPSHOTS__AWS_REGION
    value: us-east-1
  # this needs to be a bucket that all 3 nodes can reach
  - name: RESTATE_WORKER__SNAPSHOTS__DESTINATION
    value: "s3://global-bucket/snapshots"
