[build]
pre-build = [
    "apt-get update && apt-get install -y unzip && rm -rf /var/lib/apt/lists/*",
    "curl -OL https://github.com/protocolbuffers/protobuf/releases/download/v21.12/protoc-21.12-linux-x86_64.zip",
    "unzip -o protoc-21.12-linux-x86_64.zip -d /usr/local bin/protoc",
    "unzip -o protoc-21.12-linux-x86_64.zip -d /usr/local 'include/*'",
    "rm -f protoc-21.12-linux-x86_64.zip",
    "chmod +x /usr/local/bin/protoc",
    "test -d /opt/osxcross && (mkdir -p /opt/osxcross/ld/bin && ln -s /opt/osxcross/bin/x86_64-apple-darwin20.4-ld /opt/osxcross/ld/bin/ld) || true",
]

[build.env]
passthrough = ["BINDGEN_EXTRA_CLANG_ARGS", "CFLAGS", "CXXFLAGS"]

[target.aarch64-apple-darwin]
image = "ghcr.io/restatedev/cross:aarch64-apple-darwin"

[target.x86_64-apple-darwin]
image = "ghcr.io/restatedev/cross:x86_64-apple-darwin"
